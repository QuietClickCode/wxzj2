<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
		namespace：必须与对应的接口全类名一致
		id:必须与对应接口的某个对应的方法名一致
	 -->
<mapper namespace="com.yaltec.wxzj2.biz.payment.dao.UnitPaymentDao">
	<!-- 查询单位预交信息-->
	<select id="queryUnitToPrepay" resultType="com.yaltec.wxzj2.biz.payment.entity.UnitToPrepay" parameterType="java.util.Map">
		<![CDATA[
			select * from DeveloperComPay where 
			convert(varchar(10),ywrq,120)>=convert(varchar(10),#{begindate},120)
			and convert(varchar(10),ywrq,120)<=convert(varchar(10),#{enddate},120)
		]]>
		<if test="dwbm != null and '' != dwbm">
			<![CDATA[ and dwbm like '%'+#{dwbm}+'%' ]]>	
		</if>
		<if test="ywrq != null and '' != ywrq">
			<![CDATA[ and ywrq like '%'+#{ywrq}+'%' ]]>	
		</if>
		<![CDATA[ order by ywrq]]>      
	</select>		
	
	<!--新增单位预交-->
	<select id="saveUnitToPrepay" parameterType="java.util.Map" statementType="CALLABLE">
		<![CDATA[    
			{call P_DeveloperPayment(
				#{dwbm,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{dwmc,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{zybm,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{zymc,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{ywrq,javaType=java.lang.String,jdbcType=DATE,mode=IN},
				#{yhbh,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{yhmc,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{jkje,javaType=java.lang.String,jdbcType=DECIMAL,mode=IN},
				#{pjh,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{username,javaType=java.lang.String,jdbcType=VARCHAR,mode=IN},
				#{result,javaType=java.lang.String,jdbcType=SMALLINT,mode=OUT}
			)}
		]]>		
	</select>
	
	<!--根据ywbh查询已审核凭证数据-->
	<select id="isAudit" parameterType="java.util.List" resultType="com.yaltec.wxzj2.biz.payment.entity.UnitToPrepay">
		<![CDATA[select *  FROM DeveloperComPay]]>
		<where>
			<![CDATA[ isnull(pzbh,'')<>'' and  ]]>
			<foreach collection="list" index="index" item="ywbh" open="(" separator="OR " close=")">
				<![CDATA[ywbh=#{ywbh}]]>
			</foreach>
		</where>
	</select>
	
	
	<!--根据业务编号批量删除单位预交--> 
    <delete id="delUnitToPrepay" parameterType="java.util.List">
		<![CDATA[DELETE FROM DeveloperComPay]]>
		<where>
			<foreach collection="list" index="index" item="ywbh" open="(" separator="OR " close=")">
				<![CDATA[ywbh=#{ywbh}]]>
			</foreach>
		</where>
	</delete>
	
	<!--单位预交证明-->
	<select id="toPrint" parameterType="java.util.List"
		resultType="com.yaltec.wxzj2.biz.payment.entity.UnitToPrepay">
	<![CDATA[
		select dwbm,dwmc,unitcode,unitname,ywrq,yhmc,jkje from DeveloperComPay 
	]]>
		<where>
			<foreach collection="list" index="index" item="dwbm" open="(" separator="OR " close=")">
			<![CDATA[dwbm=#{dwbm}]]>
			</foreach>	
		</where>
	<![CDATA[ order by dwbm ]]>
	</select>
	
</mapper>